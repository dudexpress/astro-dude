---
import BaseBox from "../boxes/BaseBox.astro";
import BaseSection from "./BaseSection.astro";
import DurationBox from "../boxes/DurationBox.astro";
import ScoreBox from "../boxes/ScoreBox.astro";
import HypeBox from "../boxes/HypeBox.astro";
import PublisherBox from "../boxes/PublisherBox.astro";
import SidebarLinks from "../SidebarLinks.astro";
import StandBox from "../boxes/StandBox.astro";
import PlayerCountBox from "../boxes/PlayerCountBox.astro";
import type {Frontmatter, PostWeight} from "../../types";
import WeightBox from "../boxes/WeightBox.astro";
import GameCard from "../misc/GameCard.astro";
import {buildPosts, getPostFiles, sortPosts} from "../../utils.ts";

interface Props {
  title: string
  hype?: number
  score?: number
  slug: string
  player_count: number
  player_count_official: string
  weight: PostWeight
  playing_time: string
  playing_time_official: string
  publisher: string
  stand: string
  mechanism: string[]
}

const {
  title,
  hype,
  score,
  slug,
  player_count,
  player_count_official,
  weight,
  playing_time,
  playing_time_official,
  mechanism,
  publisher,
  stand,
} = Astro.props;

const allPosts = (await buildPosts(getPostFiles())).sort(sortPosts)
const search = slug == null ? null : `/${slug}/`
const review = allPosts.find(x => x != null && search != null && x.file.includes(search))
---

<BaseSection title={title} trait="pink" className="mb-4">
    <div slot="afterTitle" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-0 -mx-1.5">
      {score &&
              <ScoreBox value={score} small/>}
      {hype &&
              <HypeBox value={hype} small/>}
        <DurationBox value={playing_time} officialValue={playing_time_official} small/>
        <WeightBox value={weight} small/>
        <PlayerCountBox value={player_count} officialValue={player_count_official} small/>
        <PublisherBox value={publisher} small/>
        <StandBox value={stand} small/>
        <div class="col-span-1 md:col-span-2 xl:col-span-3">
            <BaseBox title="Meccaniche" small noHeight>
                <SidebarLinks type="mechanisms" values={mechanism} small/>
            </BaseBox>
        </div>
    </div>
    <div class="mt-4">
        <slot/>
    </div>
  {review && <GameCard {...review} className="my-5 bg-white !border-[#d7e1ea] hover:!border-[#bdccdb]" />}
</BaseSection>
