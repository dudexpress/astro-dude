---
import {Image} from "astro:assets";
import type {Frontmatter} from "../types.ts";
import LinkCtaBtn from "./LinkCtaBtn.astro";
import {formatDate, getUrl} from "../utils";

interface Props {
  file: string;
  frontmatter: Pick<Frontmatter, "title" | "description" | "designer" | "publisher" | "type" | "date">;
  isHomepage?: boolean;
}

const {frontmatter, file, isHomepage = false} = Astro.props;

const folder = '/' + file.replace('/index.mdx', '').split('/src/').pop()
const images = Object.entries(import.meta.glob<{ default: ImageMetadata }>(
  '/src/**/_cover*',
  {eager: true}
)).filter(([imagePath, imageFn]) => {
  return imagePath.includes(folder);
})

const image = images[0][1]?.default

const designersAndPublisher = ["", ...(frontmatter.designer ?? []), ...(frontmatter.publisher ?? [])].join(" ‚óè ");

const title = ['review', 'preview', 'next'].includes(frontmatter.type)
  ? "Leggi la recensione"
  : "Leggi l'articolo";

const url = getUrl(file);
---

<header class="py-7.5 md:py-15 flex justify-center">
    <div class="container">
        <div class="flex flex-col md:grid grid-cols-4 gap-3">
            <div>
                <Image
                        src={image}
                        class="rounded-2xl w-[50%] md:w-full"
                        alt={frontmatter.title + " cover"}
                />
            </div>
            <div class="col-span-3 flex flex-col justify-center mt-2 md:mt-0">
                <div class="flex flex-row gap-1 text-gray300">
                    <strong class="font-semibold">
                        <span class="font-normal">#Dude</span>{
                      frontmatter.type.replace(/\b[a-z]/g, (x) => x.toUpperCase())
                    }
                      {designersAndPublisher}
                    </strong>
                </div>
                <h1
                        class="text-[50px] md:text-[75px] lg:text-[100px] mb-2 leading-none font-bold mt-1"
                >
                  {frontmatter.title}
                </h1>
                <p class="text-xl font-serif text-gray300">{frontmatter.description}</p>
              {
                isHomepage ? (
                        <div class="mt-3">
                            <LinkCtaBtn slug={url} title={title}/>
                        </div>
                ) : (
                        <small class="mt-4 font-light text-gray300 font-serif">
                            Data pubblicazione: {formatDate(frontmatter.date)}
                        </small>
                )
              }
            </div>
        </div>
    </div>
</header>
